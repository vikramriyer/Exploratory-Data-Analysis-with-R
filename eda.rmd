---
title: Exploratory Data Analysis - Red Wine Quality
author: Vikram Iyer
output: html_document
---
```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo=FALSE, warning=FALSE, message=FALSE)
# use wineQualityReds.csv for the dataset
# use the Redirecting.txt to read about the dataset
```

#Familiarize with data

###Objective 

To analyze all the chemical properties of the red wine and determine which factors might be resposible for good quality red wine.

###Introduction

Looking at the variables in the dataset, there are some really interesting questions that can be answered.

- Does high content of alcohol increase the quality of red wine?
- Does high content of sugar make the red wine more tasty and hence result in higher quality product?

Let's explore the data and find out answers to above questions as well as pictographically understand the data. 
We will be plotting graphs, identifying the outliers and drawing some inferences about data by looking at the various plots(historgrams, scatterplots, bar plots, etc)

```{r}
# Load data
df <- read.csv('/data/myhome/vikram-code-school/ND/P4/datasets/wineQualityReds.csv')

#import required packages
library(ggplot2)
library(gridExtra)
library(GGally)
```

#Univariate Analysis

```{r}
# The variable 'X' in the dataframe is just the index and we wont be using it throughout the exploration, let's drop it.
wine <- subset(df, select = -c(X))

# Column 'X' dropped
names(wine)
```

```{r, echo=TRUE}
# Convert quality to factor
wine$quality.as_factor <- factor(wine$quality)

# Prepare data (quality) for categorization
levels(wine$quality.as_factor)
```

```{r}
p1 <- ggplot(aes(x = quality), data = wine) +
  geom_bar(stat = 'count', color = 'black', fill = 'grey')

p2 <- ggplot(aes(x = citric.acid), data = wine, binwidth = 0.01) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey')

p3 <- ggplot(aes(x = alcohol), data = wine) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey')

p4 <- ggplot(aes(x = sulphates), data = wine) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey')

p5 <- ggplot(aes(x = fixed.acidity), data = wine, binwidth = 0.1) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey')

p6 <- ggplot(aes(x = density), data = wine) +
  geom_histogram(color = 'black', fill = 'grey')

p7 <- ggplot(aes(x = pH), data = wine) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey')

p8 <- ggplot(aes(x = total.sulfur.dioxide), data = wine) +
  scale_x_continuous(limits = c(0,170), breaks = seq(0,170,5)) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey')

p9 <- ggplot(aes(x = volatile.acidity), data = wine, binwidth = 0.01) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey')

p10 <- ggplot(aes(x = free.sulfur.dioxide), data = wine) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey')

p11 <- ggplot(aes(x = chlorides), data = wine) +
  scale_x_continuous(limits = c(0,0.2), breaks = seq(0,0.2,0.01)) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey')

p12 <- ggplot(aes(x = residual.sugar), data = wine) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey')

```

```{r}
grid.arrange(p1, p2, p3, p4, ncol = 2)
```

```{r}
grid.arrange(p5, p6, p7, p8, ncol = 2)
```

```{r}
grid.arrange(p9, p10, p11, p12, ncol = 2)
```

Categorizing distributions of the Variables

- Normal
    - alcohol
    - fixed.acidity
    - volatile.acidity
    - density
    - pH
- Non Normal (skewed, uniform, etc)
    - citric.acid
    - residual.sugar
    - chlorides
    - free.sulphur.dioxide
    - total.sulphur.dioxide
    - sulphates

####So, we need to transform the variables which do not look normal or close to. We can use the log10
```{r}
t1 <- ggplot(aes(x = sulphates), data = wine) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey') +
  scale_x_log10()

t2 <- ggplot(aes(x = total.sulfur.dioxide), data = wine) +
  scale_x_continuous(limits = c(0,170), breaks = seq(0,170,5)) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey') +
  scale_x_log10()

t3 <- ggplot(aes(x = free.sulfur.dioxide), data = wine) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey') +
  scale_x_log10()

t4 <- ggplot(aes(x = chlorides), data = wine) +
  scale_x_continuous(limits = c(0,0.2), breaks = seq(0,0.2,0.01)) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey') +
  scale_x_log10()

t5 <- ggplot(aes(x = residual.sugar), data = wine) +
  geom_histogram(stat = 'count', color = 'black', fill = 'grey')

grid.arrange(t1, t2, t3, t4, t5, ncol = 2)
```

####Let's further classify quality of wine into 3 ordinal variables: low(3,4), medium(5,6), best(7,8)
```{r, echo=TRUE}
low <- wine$quality <= 4
medium <- wine$quality > 4 & wine$quality < 7
best <- wine$quality > 6
wine$quality.category <- factor(ifelse(low, 'low', 
                                ifelse(medium, 'medium', 'best')), 
                                levels = c("low", "medium", "best"))
levels(wine$quality.category)
```

#BiVariate Analysis

We can use the ggpairs function to find the level of corelation between the variables so that ones with very less relevance can be skipped

```{r  fig.width=16, fig.height=16 }

#about the function
my_fn <- function(data, mapping, method = 'lm'){
  plot <- ggplot(data = data, mapping = mapping) +
  geom_point() +
  geom_smooth(method = method)
  plot
}

ggpairs(wine, c('fixed.acidity', 'volatile.acidity', 'citric.acid',
                'residual.sugar', 'chlorides', 'free.sulfur.dioxide',
                'total.sulfur.dioxide', 'density', 'pH', 'sulphates',
                'alcohol', 'quality'), title = 'bivariate red wine analysis',
                lower = list(continuous = my_fn))
```

####Comparing each of the attributes/compounds of wine with quality and coming to conclusions
```{r}
ggplot(aes(x = quality.category, y = alcohol), data = wine) +
  geom_boxplot()
## higher the content of alcohol, better the quality
```

####Let's draw plots for all variables against quality of red wine and analyze which variable has a relation(positive, negative, no relation) with quality of red wine
```{r}
names(wine)
b1 <- ggplot(aes(x = quality.category, y = alcohol), data = wine) +
  geom_boxplot(fill="green")
b2 <- ggplot(aes(x = quality.category, y = citric.acid), data = wine) +
  geom_boxplot(fill="green")
b3 <- ggplot(aes(x = quality.category, y = sulphates), data = wine) +
  geom_boxplot(fill="green")
b4 <- ggplot(aes(x = quality.category, y = fixed.acidity), data = wine) +
  geom_boxplot(fill="green")
grid.arrange(b1, b2, b3, b4, ncol = 2)
```

####*Conclusion*: The above factors depict that, they are directly proportional to quality of red wine, i.e. higher the factor, better the quality

####Let's check the remaining ones
```{r}
b5 <- ggplot(aes(x = quality.category, y = pH), data = wine) +
  geom_boxplot(fill="red")
b6 <- ggplot(aes(x = quality.category, y = density), data = wine) +
  geom_boxplot(fill="red")
b7 <- ggplot(aes(x = quality.category, y = volatile.acidity), data = wine) +
  geom_boxplot(fill="red")
grid.arrange(b5, b6, b7, ncol = 2)
```

####*Conclusion*: The above factors denote that, they are inversely proportional to quality of red wine, i.e. lower the factor, better the quality
```

####*Conclusions*: Some variables which should be checked for corelations are plotted below: (some samples)
####Criteria for picking the variables for futher analysis, the corelation coefficient > 0.5 or coefficient < -0.5


#Final plots (Multivariate Analysis)
```{r}
# fixed.acidity vs density
ggplot(aes(x = fixed.acidity, y = density), data = wine) +
  geom_point(aes(color = quality.category, alpha = 1/5)) +
  geom_smooth(method = 'lm', color = 'red') +
  ggtitle('fixed.acidity vs density') +
  theme(plot.title = element_text(face="bold"))
```
####The above plot clearly shows that, there is a positive corelation between density and fixed.acidity in determining the quality of wine

```{r}
# fixed.acidity with pH
ggplot(aes(x = fixed.acidity, y = pH), data = wine) +
  geom_point(aes(color = quality.category)) +
  geom_smooth(method = 'lm', color = 'red') +
  ggtitle('fixed.acidity vs pH') +
  theme(plot.title = element_text(face="bold"))
```
####The above plot denotes that, higher the pH and lower the fixed.acidity, better the quality of wine
####*Note*: It should also be noted that, the pH value is mostly in the range of 3 to 4

```{r}
paste(round(length(wine$pH[wine$pH < 4 & wine$pH > 3])/length(wine$pH)*100), '%')
```
####So, out of the total 1599 observations, approximately 98% observations have pH value in the range 3-4

```{r}
# fixed.acidity with citric.acid
ggplot(aes(x = fixed.acidity, y = citric.acid), data = wine) +
  geom_point(aes(color = quality.category)) +
  geom_smooth(method = 'lm', color = 'red') +
  ggtitle('fixed.acidity vs citric.acid') +
  theme(plot.title = element_text(face="bold"))
```
####Let's just verify if the above plot is uniform across all the levels of quality since I can see a lot of red dots below the corelation slope

```{r}
ggplot(aes(x = fixed.acidity, y = citric.acid), data = wine) +
  facet_wrap(~quality.category) +
  geom_point(aes(color = quality.category)) +
  geom_smooth(method = 'lm', color = 'red') +
  ggtitle('fixed.acidity vs citric.acid faceted by quality') +
  theme(plot.title = element_text(face="bold"))
```
####As we can see above the slope in the initial plot was correct and the relation is positive, i.e. for higher values of citric acid and fixed acidity, the perceived quality of wine is better

```{r}
# density with alcohol
ggplot(aes(x = alcohol,y = density), data=wine)+
  geom_point(aes(color=wine$quality.category))+
  geom_smooth(method = "lm", color = 'red') +
  xlab("alcohol %") +
  ggtitle('density vs alcohol') +
  theme(plot.title = element_text(face="bold"))
```

#Reflection
####While I was plotting the graphs, I had to check each data field with every other one. This dataset was fairly small; however, when dealing with large datasets, not even a single aspect should be missed i.e. considering each and every case and analysis about them. Using the methods done above, there is a lot of manual work. To reduce this manual work, we should be depending more on robust machine learning models for prediction about various permutations and combinations of dataset.

#Conclusion
####EDA is perhaps the best tool to undestand the data and feel it. It is useful when you want to visualize data even before thinking of models and writing code. However, it may have some limitations since it depends on the collected data (i.e. sample) and hence more data may result in changes in the conclusion about the dependent and independent variables

#References:
[Acids in Wine](https://en.wikipedia.org/wiki/Acids_in_wine)

[ROC curves](http://blog.yhat.com/posts/roc-curves.html)

[Rgraphics](http://tutorials.iq.harvard.edu/R/Rgraphics/Rgraphics.html)

[Error](http://stackoverflow.com/questions/27207963/arrange-not-working-on-grouped-data-frame)

[Penn State Analysis](https://onlinecourses.science.psu.edu/stat857/node/4)
