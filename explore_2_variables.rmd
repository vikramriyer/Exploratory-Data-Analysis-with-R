---
title: "explore_2_variables"
author: "vikram"
date: "26 January 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## qplot vs ggplot syntax
```{r}
pf = read.csv('/home/vikram.iyer/vikram-code-school/ND/P4/datasets/pseudo_facebook.tsv', sep = '\t', header = TRUE)
summary(pf)
names(pf)
summary(pf$age)

qplot(x = age, y = friend_count, data = pf)

ggplot(aes(x = age, y = friend_count), data = pf) + # aesthetic wrapper is necessary in case of ggplot
  geom_point() + # scatter plot
  xlim(13,90) # people having age less than 13 are not allowed to use facebook, and above 90 less likely to use
```

```{r}
## Since the lower area is densely populated, we are unable to see the points carefully
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_point(alpha = 1/20) +
  xlim(13,90)

## THis looks a tad bit better, however, we still do not get a feel of the distribution
## Let's try adding some change
```
```{r}
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_jitter(alpha = 1/20) +
  xlim(13,90)
## Aha, this gives a better view of the distribution :)
```

```{r}
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_point(alpha = 1/20) +
  xlim(13,90) +
  coord_trans(y = 'sqrt')
```

```{r}
## To use jitter with the above plot, there is a more advanced syntax and it is as below, which given a better view of the plot
## h = 0, ensures that there are no negative points since some people have a friend count of 0, a min acceptable height is 0,
## jitter actually adds positive or negative noise to the points and thus, it may add negative for 0 friend count users
ggplot(aes(x = age, y = friend_count), data = pf) +
  geom_jitter(alpha = 1/20, position = position_jitter(h = 0)) +
  xlim(13,90) +
  coord_trans(y = 'sqrt')
```

```{r}
## Friendships initiated
ggplot(aes(x = age, y = friendships_initiated), data = pf) +
  geom_jitter(alpha = 1/20, position = position_jitter(h = 0)) +
  xlim(13,90) +
  coord_trans(y = 'sqrt')
## IT seems younger people initiate more friendsips than the oldies

by(pf$friendships_initiated, pf$age, summary) # This will give a count of friendships initiated at every age in the dataset

# Let's break down the plot into various ages
ggplot(aes(x = age, y = friendships_initiated), data = pf) +
  geom_jitter(alpha = 1/20, position = position_jitter(h = 0)) +
  xlim(13,30) +
  coord_trans(y = 'sqrt')

ggplot(aes(x = age, y = friendships_initiated), data = pf) +
  geom_jitter(alpha = 1/20, position = position_jitter(h = 0)) +
  xlim(31,50) +
  coord_trans(y = 'sqrt')

ggplot(aes(x = age, y = friendships_initiated), data = pf) +
  geom_jitter(alpha = 1/20, position = position_jitter(h = 0)) +
  xlim(50,90) +
  coord_trans(y = 'sqrt')
```

## Conditional means
```{r}
## for every age, what is the mean and median of the friend counts, and the total count as well
library(dplyr)
age_groups <- group_by(pf, age)
pf.fc_by_age <- summarise(age_groups,
          friend_count_mean = mean(friend_count),
          friend_count_median = median(friend_count),
          n = n())
pf.fc_by_age <- arrange(pf.fc_by_age, age)
head(pf.fc_by_age)
```

## Alternate code for conditional means
```{r}
pf.fc_by_age <- pf %>%
  group_by(age) %>%
  summarise(friend_count_mean = mean(as.numeric(friend_count)),
            friend_count_median = median(as.numeric(friend_count)),
            n = n()) %>%
  arrange(age)

head(pf.fc_by_age)
```

## dpylr basics
```{r}
## a dplyr, allows us to split a particular dataframe and apply functions to manipulate/change certain parts of the data, like only applying a certain function to a field
## below we can see tht mean, median are applied to only the friend count

dim(pf.fc_by_age)
summary(pf.fc_by_age)
pf.fc_by_age
filter(pf.fc_by_age, (age >= 13 & age <= 20) | (age >= 20 & age <= 21))
# The above statement is an alternative to verbose code in traditional R which is written as below
na.omit(pf.fc_by_age[(pf.fc_by_age >= 13 & pf.fc_by_age$age <= 20) | (pf.fc_by_age >= 20 & pf.fc_by_age$age <= 21), ])
# same can be done using the subset function as well
subset(pf.fc_by_age, (age >= 13 & age <= 20) | (age >= 20 & age <= 21))
## However, as mentioned in the doc for dpylr, any number of filtering conditions are possible with filter()
```

## friend_count_mean vs age
```{r}
ggplot(pf.fc_by_age, aes(x = age, y = friend_count_mean, color = age)) +
  geom_line()
```

## Now, I want to overlay the original plot with the one drawn above, i.e. the mean against original
```{r}
ggplot(aes(x = age, y = friend_count), data = pf) +
  xlim(13, 90) +
  geom_point(alpha = 0.05,
             position = position_jitter(h = 0),
             color = 'dark green') +
  coord_trans(y = 'sqrt') +
  geom_line(stat = 'summary',  fun.y = mean) +
  geom_line(stat = 'summary',  fun.y = quantile, fun.args = list(probs = .1), linetype = 4, color = 'red') +
  geom_line(stat = 'summary',  fun.y = quantile, fun.args = list(probs = .9), linetype = 2, color = 'blue') +
  geom_line(stat = 'summary',  fun.y = quantile, fun.args = list(probs = .5), linetype = 3, color = 'yellow')
#  coord_cartesian(xlim = c(13,90))
```

### Bonus: 
### corelation coefficient: Representing a scatter plot as a numeric value between, -1 and 1.
### Steps: to identify
#### 1. the plot fits a straight line
#### 2. the slope is either positive or negaative; -ve slope = -ve corelation coef, +ve slope = +ve cor. coef
#### 3. quality of fit - the scatter plot points are closer to the regression line
#### https://www.youtube.com/watch?v=ugd4k3dC_8Y -> wonderful video on corelation coefficient, if scatter along the y-axis is greater, then the coef is strong, and also the scatter
#### along the fitted line from step 1

### We can say that, having more than 1000 users is very rare, even for young individuals
```{r}
ggplot(aes(x = age, y = friend_count), data = pf) +
  xlim(13,90) +
  geom_point()

?cor
?cor.test()

cor(pf$age, pf$friend_count)
cor(pf$age, pf$friend_count, method = 'pearson') # by default uses pearson

with(subset(pf, age <= 70), cor.test(age, friend_count, method = 'pearson'))
with(subset(pf, age <= 70), cor.test(age, friend_count, method = 'spearman'))
## both methods give diff values 
```

# Create a scatterplot of likes_received (y) vs. www_likes_received (x). Use any of the techniques that you've learned so far to modify the plot.
### ===========================================================
```{r}
ggplot(aes(x = www_likes_received, y = likes_received), data = pf) +
  geom_point(shape=1) +
  geom_smooth(method=lm)

with(pf,cor.test(likes_received,www_likes_received))

## now we can see that there are some outliers and its difficult to see the quartiles
ggplot(aes(x = www_likes_received, y = likes_received), data = pf) +
  geom_point(shape=1) +
  geom_smooth(method=lm, color = 'red') + ## adds a regression line
  xlim(0, quantile(pf$www_likes_received, 0.95)) +# choose 95 percent quartile as uper bound
  ylim(0, quantile(pf$likes_received, 0.95))
```








